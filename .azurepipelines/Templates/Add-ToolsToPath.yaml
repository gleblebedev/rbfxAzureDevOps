# Add tools to path
steps:
- task: UseDotNet@2
  displayName: 'Install .NET 6 SDK'
  inputs:
    packageType: 'sdk'
    version: '6.0.x'

- task: UseDotNet@2
  displayName: 'Install .NET 7 SDK'
  inputs:
    packageType: 'sdk'
    version: '7.0.x'

- script: dotnet tool restore
  displayName: 'Restore dotnet tools'
  workingDirectory: $(Build.SourcesDirectory)
  
- pwsh: |
    If ($IsWindows)
    {
      New-Item -ItemType Directory -Path "$(Agent.BuildDirectory)\s\tools\win\cl\"
      New-Item -ItemType SymbolicLink -Path "$(Agent.BuildDirectory)\s\tools\win\cl\cl.exe" -Target "$(Agent.BuildDirectory)\s\tools\win\ccache.exe"
      $toolsFolder = "$(Agent.BuildDirectory)\s\tools\win";
      Write-Host "##vso[task.setvariable variable=PATH;]${toolsFolder};${env:PATH}";
      Invoke-Expression "$toolsFolder\ninja.exe --version";
    }
    ElseIf ($IsLinux)
    {
      $toolsFolder = "$(Build.SourcesDirectory)/tools/linux";
      Write-Host "##vso[task.setvariable variable=PATH;]${toolsFolder}:${env:PATH}";
      Invoke-Expression "$toolsFolder/ninja --version";
    }
    ElseIf ($IsMacOS)
    {
      $toolsFolder = "$(Build.SourcesDirectory)/tools/mac";
      Write-Host "##vso[task.setvariable variable=PATH;]${toolsFolder}:${env:PATH}";
      Invoke-Expression "$toolsFolder/ninja --version";
    }
  displayName: 'Add tools to path'
